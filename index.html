<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Base Jackpot Demo</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@6/dist/ethers.min.js"></script>
  <style>
    body{font-family:system-ui;background:#0b1220;color:#fff;padding:24px}
    button{padding:8px 12px;margin:6px}
    input{padding:6px;margin:6px}
    pre{background:#061020;padding:12px;border-radius:8px}
  </style>
</head>
<body>
  <h2>Base Jackpot - Demo (ethers.js)</h2>
  <div>
    <button id="connect">Connect Wallet</button>
    <button id="commit" disabled>Commit Round (owner)</button>
    <button id="enter" disabled>Enter Round (0.01)</button>
    <button id="reveal" disabled>Reveal Round (owner)</button>
  </div>
  <div>
    <input id="serverSeed" placeholder="server seed (owner)" />
    <input id="playerSeed" placeholder="player seed (hex)" />
  </div>
  <pre id="log"></pre>

<script>
const logEl = document.getElementById('log');
function log(txt){ logEl.textContent = new Date().toISOString() + " - " + txt + "\\n" + logEl.textContent; }

let provider, signer, contract;
const CONTRACT_ADDRESS = "PASTE_YOUR_DEPLOYED_CONTRACT_ADDRESS_HERE";
const ABI = [ /* minimal ABI subset: commitRound, enter, revealRound */ 
  "function commitRound(bytes32) external",
  "function enter(bytes32) external payable",
  "function revealRound(string) external",
  "event RoundCommitted(uint256, bytes32)",
  "event PlayerEntered(uint256, address, uint256)",
  "event RoundRevealed(uint256, string, address, uint256)"
];

document.getElementById('connect').onclick = async ()=>{
  if (!window.ethereum) return alert("Install MetaMask");
  provider = new ethers.BrowserProvider(window.ethereum);
  await provider.send("eth_requestAccounts", []);
  signer = await provider.getSigner();
  contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);
  log("Connected: " + await signer.getAddress());
  document.getElementById('commit').disabled = false;
  document.getElementById('enter').disabled = false;
  document.getElementById('reveal').disabled = false;
};

document.getElementById('commit').onclick = async ()=>{
  const seed = document.getElementById('serverSeed').value;
  if(!seed) return alert("Set serverSeed");
  const hash = ethers.keccak256(ethers.toUtf8Bytes(seed));
  const tx = await contract.commitRound(hash);
  log("Commit tx sent: " + tx.hash);
  await tx.wait();
  log("Committed round with hash: " + hash);
};

document.getElementById('enter').onclick = async ()=>{
  if(!contract) return alert("Connect first");
  const playerSeed = document.getElementById('playerSeed').value || "0x0000000000000000000000000000000000000000000000000000000000000000";
  // stake 0.01 ETH (adjust to Base token)
  const stake = ethers.parseEther("0.01");
  const tx = await contract.enter(playerSeed, { value: stake });
  log("Enter tx: " + tx.hash);
  await tx.wait();
  log("Entered round");
};

document.getElementById('reveal').onclick = async ()=>{
  const seed = document.getElementById('serverSeed').value;
  if(!seed) return alert("Set serverSeed");
  const tx = await contract.revealRound(seed);
  log("Reveal tx sent: " + tx.hash);
  await tx.wait();
  log("Reveal completed");
};
</script>
</body>
</html>